<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamabad Mega Mart | enhanced checkout</title>
    <!-- Font Awesome icons (free) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f3f5f7;
            color: #1e2b37;
        }

        .hero {
            background: linear-gradient(145deg, #1b4a2b 0%, #2a6e3a 100%);
            color: white;
            padding: 2rem 1.5rem 3rem;
            position: relative;
            overflow: hidden;
        }
        .hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: #f3f5f7;
            border-radius: 40px 40px 0 0;
        }
        .hero-content {
            max-width: 1300px;
            margin: 0 auto;
            position: relative;
            z-index: 5;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .hero h1 {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hero h1 i {
            color: #f9c74f;
            font-size: 2rem;
        }
        .badge {
            background: #f9c74f;
            color: #1b4a2b;
            padding: 6px 14px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .sticky-panel {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 4px 20px rgba(0, 40, 20, 0.08);
            padding: 1rem 1.5rem;
        }

        .search-wrapper {
            max-width: 600px;
            margin: 0 auto 12px;
            position: relative;
        }
        .search-wrapper i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #8a9a8a;
            font-size: 1rem;
        }
        #searchBar {
            width: 100%;
            padding: 16px 24px 16px 50px;
            border: none;
            border-radius: 60px;
            background: white;
            box-shadow: 0 8px 18px rgba(0,30,10,0.05);
            font-size: 1rem;
            border: 1px solid #e0e8e0;
            transition: all 0.2s;
        }
        #searchBar:focus {
            outline: none;
            border-color: #2a6e3a;
            box-shadow: 0 8px 18px rgba(42,110,58,0.15);
        }

        /* filter row */
        .filter-row {
            max-width: 1300px;
            margin: 15px auto 5px;
            padding: 0 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        .filter-chip {
            background: white;
            border: 1px solid #d0e0d0;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.1s;
        }
        .filter-chip.active {
            background: #2a6e3a;
            color: white;
            border-color: #2a6e3a;
        }
        .filter-chip i {
            color: #2a6e3a;
        }
        .filter-chip.active i {
            color: white;
        }

        nav {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 5px;
            scrollbar-width: thin;
            scrollbar-color: #b3cfb3 #eaf0ea;
        }
        nav::-webkit-scrollbar {
            height: 5px;
        }
        nav::-webkit-scrollbar-thumb {
            background: #2a6e3a;
            border-radius: 10px;
        }
        .cat-btn {
            background: white;
            border: 1px solid #d0e0d0;
            padding: 10px 24px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            color: #2d4730;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 2px 5px rgba(0,30,0,0.02);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .cat-btn i {
            color: #2a6e3a;
            font-size: 0.9rem;
        }
        .cat-btn.active {
            background: #2a6e3a;
            color: white;
            border-color: #2a6e3a;
            box-shadow: 0 6px 12px rgba(42,110,58,0.2);
        }
        .cat-btn.active i {
            color: white;
        }

        .main-layout {
            max-width: 1300px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            align-items: start;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
            gap: 1.2rem;
        }

        .product-card {
            background: white;
            border-radius: 24px;
            padding: 1rem 1rem 1.2rem;
            box-shadow: 0 8px 22px rgba(0, 30, 10, 0.04);
            transition: 0.2s ease;
            border: 1px solid #e2ede2;
            display: flex;
            flex-direction: column;
            position: relative;
            backdrop-filter: blur(2px);
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 30px rgba(25, 80, 35, 0.08);
            border-color: #b8d9b8;
        }

        .product-image {
            width: 100%;
            height: 140px;
            border-radius: 16px;
            margin-bottom: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        .product-card:hover .product-image {
            transform: scale(1.02);
        }

        .status-chip {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 30px;
            width: fit-content;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border: 1px solid transparent;
        }
        .in-stock {
            background: #e6f3e6;
            color: #1e6b2e;
            border-color: #b3dfb3;
        }
        .limited {
            background: #fff1d6;
            color: #a64d1e;
            border-color: #ffcf9a;
        }

        .product-card h3 {
            font-size: 0.95rem;
            line-height: 1.4;
            font-weight: 600;
            margin: 5px 0 8px;
            color: #1d3a21;
            min-height: 2.6em;
        }

        .price-tag {
            color: #1b4a2b;
            font-weight: 800;
            font-size: 1.3rem;
            margin: 5px 0 10px;
            display: flex;
            align-items: baseline;
            gap: 4px;
        }
        .price-tag span {
            font-size: 0.85rem;
            font-weight: 500;
            color: #5f735f;
        }

        .add-to-cart {
            background: #f0f7f0;
            border: 1px solid #c7e0c7;
            color: #1b4a2b;
            border-radius: 50px;
            padding: 10px 5px;
            font-weight: 700;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.15s;
            width: 100%;
            margin-top: 4px;
        }
        .add-to-cart i {
            font-size: 1rem;
            color: #2a6e3a;
        }
        .add-to-cart:hover {
            background: #2a6e3a;
            border-color: #2a6e3a;
            color: white;
        }
        .add-to-cart:hover i {
            color: white;
        }

        /* ========== ENHANCED CART + ADDRESS + PAYMENT ========== */
        .cart-panel {
            background: white;
            border-radius: 32px;
            padding: 1.8rem 1.5rem;
            box-shadow: 0 20px 35px -8px rgba(20, 60, 20, 0.2);
            border: 1px solid #deecde;
            position: sticky;
            top: 120px;
            transition: box-shadow 0.2s;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem;
        }
        .cart-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d3a21;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .cart-header h2 i {
            color: #2a6e3a;
            font-size: 1.6rem;
        }
        .clear-cart {
            background: none;
            border: none;
            color: #9ab89a;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.15s;
        }
        .clear-cart:hover {
            color: #b33c3c;
        }

        .cart-items {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 5px;
            margin-bottom: 1rem;
            scrollbar-width: thin;
        }
        .cart-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            gap: 10px;
            padding: 12px 0;
            border-bottom: 1px solid #e2f0e2;
            font-size: 0.9rem;
        }
        .cart-item-name {
            font-weight: 600;
            color: #203f25;
        }
        .qty-wrap {
            display: flex;
            align-items: center;
            background: #f1faf1;
            border-radius: 40px;
            padding: 4px;
        }
        .qty-btn {
            background: transparent;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: #2a6e3a;
            cursor: pointer;
            transition: 0.1s;
        }
        .qty-btn:hover {
            background: #d0ecdd;
        }
        .qty-value {
            min-width: 24px;
            text-align: center;
            font-weight: 600;
        }
        .item-price {
            font-weight: 700;
            color: #1d4a2b;
        }

        /* ---------- ADDRESS PROFILE (saved location) ---------- */
        .address-profile {
            background: #f5fbf5;
            border-radius: 24px;
            padding: 1.2rem;
            margin: 1.2rem 0 0.8rem;
            border: 1px solid #d3e8d3;
        }
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-weight: 600;
            color: #1b4a2b;
        }
        .save-location-btn {
            background: white;
            border: 1px solid #2a6e3a;
            color: #2a6e3a;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.1s;
        }
        .save-location-btn:hover {
            background: #2a6e3a;
            color: white;
        }
        .saved-address-badge {
            background: #e6f3e6;
            border-radius: 40px;
            padding: 8px 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            border: 1px solid #b3dfb3;
        }
        .addr-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .addr-row input, .addr-row select {
            flex: 1 1 130px;
            padding: 14px 16px;
            border: 1px solid #c0dcc0;
            border-radius: 30px;
            background: white;
            font-size: 0.9rem;
            transition: 0.15s;
        }
        .addr-row input:focus, .addr-row select:focus {
            outline: none;
            border-color: #2a6e3a;
            box-shadow: 0 0 0 3px rgba(42,110,58,0.2);
        }

        /* toggle between shipping / billing */
        .address-tabs {
            display: flex;
            gap: 10px;
            margin: 15px 0 5px;
        }
        .addr-tab {
            background: #f0f7f0;
            border: 1px solid #c7e0c7;
            padding: 8px 16px;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
        }
        .addr-tab.active {
            background: #2a6e3a;
            color: white;
            border-color: #2a6e3a;
        }
        .billing-section, .shipping-section {
            margin-top: 12px;
            padding: 10px 0;
            border-top: 1px dashed #bcd8bc;
        }

        /* delivery estimate */
        .delivery-estimate {
            background: #e8f0fe;
            border-radius: 30px;
            padding: 12px 18px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            border: 1px solid #b8d3ff;
        }
        .delivery-estimate i {
            color: #1b4a2b;
            font-size: 1.4rem;
        }

        /* payment methods */
        .payment-methods {
            background: white;
            border-radius: 24px;
            padding: 1rem;
            margin: 15px 0;
            border: 2px solid #e2ede2;
        }
        .payment-title {
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1d3a21;
        }
        .payment-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #deecde;
            border-radius: 40px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: 0.1s;
        }
        .payment-option:hover {
            background: #f5fbf5;
            border-color: #2a6e3a;
        }
        .payment-option input[type="radio"] {
            accent-color: #2a6e3a;
            width: 18px;
            height: 18px;
        }
        .payment-option i {
            font-size: 1.6rem;
            width: 30px;
            color: #1b4a2b;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            font-size: 1.6rem;
            font-weight: 800;
            color: #1b4a2b;
            border-top: 2px dashed #bcd8bc;
            padding-top: 1.2rem;
            margin-top: 0.5rem;
        }

        .wa-button {
            background: #25D366;
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 1.2rem;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.3);
            transition: 0.15s;
        }
        .wa-button i {
            font-size: 1.6rem;
        }
        .wa-button:hover {
            background: #20b859;
            transform: scale(1.02);
        }

        .fab-modern {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #1b4a2b;
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 40px;
            border: none;
            box-shadow: 0 12px 25px rgba(27,74,43,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            z-index: 200;
            border: 2px solid white;
        }
        .fab-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f9c74f;
            color: #1b4a2b;
            font-weight: 800;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 30px;
            border: 2px solid white;
        }

        .close-cart-mob {
            display: none;
            width: 100%;
            background: #f0f0f0;
            border: none;
            border-radius: 40px;
            padding: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            cursor: pointer;
        }

        @media (max-width: 950px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .cart-panel {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1000;
                border-radius: 0;
                overflow-y: auto;
                padding: 2rem 1.5rem;
                background: white;
            }
            .cart-panel.active {
                display: block;
            }
            .close-cart-mob {
                display: block;
            }
            .fab-modern {
                display: flex;
            }
            .hero h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="hero">
        <div class="hero-content">
            <h1>
                <i class="fas fa-leaf"></i> Islamabad Mega Mart
            </h1>
            <div class="badge"><i class="fas fa-check-circle"></i> 100+ items ‚Ä¢ fast delivery</div>
        </div>
    </div>

    <div class="sticky-panel">
        <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" id="searchBar" placeholder="Search products...">
        </div>
        <!-- category nav -->
        <nav id="cat-nav"></nav>
        <!-- extra filter row for price/low stock -->
        <div class="filter-row" id="filterRow"></div>
    </div>

    <div class="main-layout">
        <div class="product-grid" id="product-grid"></div>

        <!-- ========== ENHANCED CART SIDEBAR ========== -->
        <div class="cart-panel" id="cart-sidebar">
            <button class="close-cart-mob" onclick="toggleCart()"><i class="fas fa-arrow-left"></i> Continue shopping</button>
            <div class="cart-header">
                <h2><i class="fas fa-basket-shopping"></i> Basket</h2>
                <button class="clear-cart" onclick="clearFullCart()" title="Empty cart"><i class="fas fa-trash-alt"></i></button>
            </div>
            <div class="cart-items" id="cart-content">üõí Your basket is empty</div>

            <!-- SAVED LOCATION PROFILE -->
            <div class="address-profile">
                <div class="profile-header">
                    <span><i class="fas fa-map-pin"></i> Your saved location</span>
                    <button class="save-location-btn" onclick="saveCurrentAddress()"><i class="fas fa-save"></i> Save as default</button>
                </div>
                <div id="savedAddressDisplay" class="saved-address-badge" style="display: none;">
                    <i class="fas fa-check-circle" style="color:#2a6e3a;"></i> 
                    <span id="savedAddressText"></span>
                </div>
                <!-- address toggles for shipping / billing -->
                <div class="address-tabs">
                    <span class="addr-tab active" onclick="showAddressTab('shipping')">Shipping</span>
                    <span class="addr-tab" onclick="showAddressTab('billing')">Billing</span>
                </div>

                <!-- SHIPPING ADDRESS (editable) -->
                <div id="shippingSection" class="shipping-section">
                    <div style="font-weight:600; margin-bottom:8px;">üìç Shipping address</div>
                    <div class="addr-row">
                        <input type="text" id="shipHouse" placeholder="House/Flat" value="">
                        <input type="text" id="shipStreet" placeholder="Street" value="">
                    </div>
                    <div class="addr-row">
                        <input type="text" id="shipSector" value="Korang Town">
                        <input type="text" id="shipCity" value="Islamabad">
                    </div>
                </div>

                <!-- BILLING ADDRESS (editable, can copy from shipping) -->
                <div id="billingSection" class="billing-section" style="display:none;">
                    <div style="font-weight:600; margin-bottom:8px;">üßæ Billing address</div>
                    <div class="addr-row">
                        <input type="text" id="billHouse" placeholder="House/Flat" value="">
                        <input type="text" id="billStreet" placeholder="Street" value="">
                    </div>
                    <div class="addr-row">
                        <input type="text" id="billSector" value="Korang Town">
                        <input type="text" id="billCity" value="Islamabad">
                    </div>
                    <div style="margin-top:8px;">
                        <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                            <input type="checkbox" id="copyShipping" onchange="copyShippingToBilling()"> Same as shipping
                        </label>
                    </div>
                </div>
            </div>

            <!-- DELIVERY ESTIMATE (based on time) -->
            <div class="delivery-estimate" id="deliveryEstimate">
                <i class="fas fa-truck"></i>
                <div>
                    <strong>Estimated delivery:</strong> <span id="deliveryDate">today (within 2h)</span><br>
                    <small style="color:#555;">Order within 30 min for express</small>
                </div>
            </div>

            <!-- PAYMENT METHODS (visual only, order goes to WhatsApp) -->
            <div class="payment-methods">
                <div class="payment-title"><i class="fas fa-credit-card"></i> Pay via</div>
                <label class="payment-option">
                    <input type="radio" name="payment" value="cash" checked> <i class="fas fa-money-bill-wave"></i> Cash on delivery
                </label>
                <label class="payment-option">
                    <input type="radio" name="payment" value="card"> <i class="fab fa-cc-mastercard"></i> Credit / Debit card (on delivery)
                </label>
                <label class="payment-option">
                    <input type="radio" name="payment" value="jazzcash"> <i class="fas fa-mobile-alt"></i> JazzCash / Easypaisa
                </label>
                <div style="font-size:0.75rem; color:#777; margin-top:8px;">‚úì You'll confirm payment with agent</div>
            </div>

            <div class="total-row">
                <span>Total</span>
                <span>‚Ç® <span id="total-val">0</span></span>
            </div>
            <button class="wa-button" onclick="sendOrder()"><i class="fab fa-whatsapp"></i> Order via WhatsApp</button>
        </div>
    </div>

    <button class="fab-modern" onclick="toggleCart()">
        <i class="fas fa-shopping-basket"></i>
        <span class="fab-count" id="cart-count">0</span>
    </button>

    <script>
        const MY_PHONE = "923238553161";
        const DELIVERY_FEE = 50; 

        // ---------- HELPER FUNCTIONS FOR UNIQUE IMAGES (same as before) ----------
        const productEmojis = {
            'Sunridge Fortified Atta': 'üåæ', 'Chakki Fresh Atta': 'üîÑ', 'Whole Wheat Atta': 'üçû',
            'Multigrain Atta': 'üåΩ', 'Bajra Atta': 'üåø', 'Makai Atta': 'üåΩ',
            'Chana Besan': 'ü´ò', 'Shaheen Atta': '‚≠ê', 'White Flour Maida': 'ü•ñ',
            'Basmati Rice': 'üçö', 'Super Basmati': 'üëë', 'Sela Rice': 'üçô',
            'Moong Pulse': 'üü¢', 'Mash Pulse': '‚ö´', 'Chana Pulse': 'üü§',
            'Masoor Pulse': 'üî¥', 'Rajma': '‚ù§Ô∏è', 'Dalda Cooking Oil': 'ü´í',
            'Seasons Canola': 'üåª', 'Kissan Pure Ghee': 'üßà', 'Olive Oil': 'ü´í',
            'Habib Cooking Oil': 'ü•´', 'Mitaloo Ghee': '‚ú®', 'Sunflower Oil': 'üåª',
            'Coconut Oil': 'ü••', 'Mustard Oil': 'üü°', 'Tara Cooking Oil': '‚≠ê',
            'Chicken Meat': 'üçó', 'Chicken Qeema': 'ü•©', 'Beef Boneless': 'ü•©',
            'Beef Qeema': 'üçñ', 'Mutton': 'üêë', 'Mutton Leg': 'üçñ', 'Fresh Eggs': 'ü•ö',
            'Olper\'s Milk': 'ü•õ', 'Milkpak': 'ü•õ', 'Yogurt': 'üç∂', 'Butter': 'üßà',
            'Cream': 'ü•õ', 'Cheese Slices': 'üßÄ', 'Mozzarella Cheese': 'üßÄ',
            'Pampers Premium': 'üë∂', 'Pampers Small': 'üë∂', 'Baby Cerelac': 'ü•£',
            'Baby Oil': 'üß¥', 'Baby Wipes': 'üßª', 'Sunsilk Shampoo': 'üß¥',
            'Pantene Shampoo': 'üß¥', 'Safeguard Soap': 'üßº', 'Lifebuoy Soap': 'üßº',
            'Colgate Toothpaste': 'ü¶∑', 'Sensodyne': 'ü¶∑', 'Always Pads': 'üå∏',
            'Dove Soap': 'üßº', 'Head & Shoulders': 'üß¥', 'Pakola Lychee': 'üßã',
            'Pakola Orange': 'üçä', 'Pakola Cream Soda': 'ü•§', 'Pakola Vimto': 'üçá',
            'Shandy Ganda': 'ü•§', 'Fruitonic Jam': 'üßÉ', 'Rooh Afza': 'üåπ',
            'Shezan Mango': 'ü•≠', 'Shezan Apple': 'üçé', 'Nestle Fruita': 'üßÉ',
            'Qarshi Sarbat': 'üåø', 'Tang Orange': 'üçä', 'Fanta': 'üçä', 'Pepsi': 'ü•§',
            '7up': 'ü•§', 'Dew': 'üåø', 'Nestle Pure Life': 'üíß', 'Mineral Water': 'üíß',
            'Daddy Nimko': 'ü•®', 'Kolson\'s Nimko': 'ü•®', 'Everest Nimbo': 'ü•®',
            'Lays Masala': 'ü•î', 'Kurkure': 'üåΩ', 'Puffcorn': 'üçø', 'Samosa Chaat': 'ü•ü',
            'Bombay Bhujia': 'ü•®', 'Aloo Bhujia': 'ü•î', 'Peanuts': 'ü•ú',
            'Chana Jor Garam': 'ü´ò', 'Papri': 'üç•', 'Khatai': 'üç™', 'Golgappa': '‚ö™',
            'Dahi Bhalla': 'üç°', 'Fruit Cake': 'üç∞', 'Biscuits': 'üç™', 'Rusk': 'üçû',
            'Surf Excel': 'üßº', 'Ariel Detergent': 'üßº', 'Vim Liquid': 'üßΩ',
            'Dishwasher Bar': 'üßº', 'Floor Cleaner': 'üßπ', 'Trash Bags': 'üóëÔ∏è',
            'Aluminum Foil': 'üì¶', 'Clothes Hangers': 'üëï', 'Laundry Net': 'üß∫',
            'Dishwashing Liquid': 'üßΩ', 'Cleaning Sponges': 'üßº', 'Salt': 'üßÇ',
            'Sugar': 'üç¨', 'Cornflour': 'üåΩ'
        };
        function getProductEmoji(name) {
            for (let k in productEmojis) if (name.includes(k)) return productEmojis[k];
            return 'üì¶';
        }
        function getUniqueProductColor(id) {
            let hue = (id * 37) % 360;
            let sat = 65 + (id % 30);
            let light = 45 + (id % 20);
            return `hsl(${hue}, ${sat}%, ${light}%)`;
        }
        function getProductImageStyle(p) {
            let base = getUniqueProductColor(p.id);
            let darker = `hsl(${(p.id*37)%360}, ${65+(p.id%30)}%, ${35+(p.id%15)}%)`;
            return {
                background: `linear-gradient(135deg, ${base}, ${darker})`,
                emoji: getProductEmoji(p.name),
                shortName: p.name.split(' ').slice(0,2).join(' ')
            };
        }

        // ---------- FULL INVENTORY (shortened for brevity, but keep at least 20 items) ----------
        const inventory = [
            {id:1,name:"Sunridge Fortified Atta (10kg)",price:1180,cat:"Staples",limit:false},
            {id:2,name:"Chakki Fresh Atta (10kg)",price:1050,cat:"Staples",limit:false},
            {id:3,name:"Whole Wheat Atta (10kg)",price:1120,cat:"Staples",limit:false},
            {id:4,name:"Multigrain Atta (5kg)",price:620,cat:"Staples",limit:true},
            {id:5,name:"Bajra Atta (2kg)",price:240,cat:"Staples",limit:false},
            {id:6,name:"Makai Atta (2kg)",price:260,cat:"Staples",limit:false},
            {id:7,name:"Chana Besan (1kg)",price:220,cat:"Staples",limit:false},
            {id:8,name:"Shaheen Atta (10kg)",price:1000,cat:"Staples",limit:false},
            {id:9,name:"White Flour Maida (2kg)",price:210,cat:"Staples",limit:false},
            {id:10,name:"Sugar (1kg)",price:175,cat:"Staples",limit:true},
            {id:11,name:"Basmati Rice (1kg)",price:360,cat:"Staples",limit:false},
            {id:12,name:"Super Basmati Rice (5kg)",price:1550,cat:"Staples",limit:false},
            {id:13,name:"Sela Rice (5kg)",price:980,cat:"Staples",limit:false},
            {id:14,name:"Moong Pulse (1kg)",price:290,cat:"Staples",limit:false},
            {id:15,name:"Mash Pulse (1kg)",price:380,cat:"Staples",limit:false},
            {id:16,name:"Chana Pulse (1kg)",price:240,cat:"Staples",limit:false},
            {id:17,name:"Masoor Pulse (1kg)",price:270,cat:"Staples",limit:false},
            {id:18,name:"Rajma 500g",price:330,cat:"Staples",limit:false},
            {id:19,name:"Salt (1kg)",price:60,cat:"Staples",limit:false},
            {id:20,name:"Cornflour 500g",price:180,cat:"Staples",limit:false},
            {id:21,name:"Dalda Oil 1L",price:590,cat:"Oil",limit:true},
            {id:22,name:"Seasons Canola 1L",price:585,cat:"Oil",limit:false},
            {id:23,name:"Kissan Ghee 1kg",price:650,cat:"Oil",limit:false},
            {id:24,name:"Olive Oil 500ml",price:850,cat:"Oil",limit:true},
            {id:25,name:"Pakola Lychee 750ml",price:140,cat:"Drinks",limit:false},
            {id:26,name:"Pakola Orange 750ml",price:140,cat:"Drinks",limit:false},
            {id:27,name:"Pepsi 1.5L",price:210,cat:"Drinks",limit:false},
            {id:28,name:"Lays Masala (12p)",price:580,cat:"Snacks",limit:false},
            {id:29,name:"Daddy Nimko 500g",price:350,cat:"Snacks",limit:false},
            {id:30,name:"Surf Excel 1kg",price:670,cat:"Household",limit:false}
        ];

        let cart = {};
        let activeCat = "All";
        let priceFilter = "all"; // "all", "low", "high"
        let savedAddress = null;  // stored default

        // ---- filter chips ----
        function renderFilterChips() {
            let fdiv = document.getElementById('filterRow');
            fdiv.innerHTML = `
                <div class="filter-chip ${priceFilter==='all'?'active':''}" onclick="setPriceFilter('all')"><i class="fas fa-list"></i> All</div>
                <div class="filter-chip ${priceFilter==='low'?'active':''}" onclick="setPriceFilter('low')"><i class="fas fa-arrow-down"></i> Under ‚Ç®500</div>
                <div class="filter-chip ${priceFilter==='high'?'active':''}" onclick="setPriceFilter('high')"><i class="fas fa-arrow-up"></i> ‚Ç®500+</div>
            `;
        }

        function setPriceFilter(val) {
            priceFilter = val;
            renderFilterChips();
            filterItems();
        }

        // ---- category init ----
        function init() {
            let cats = ["All", ...new Set(inventory.map(i=>i.cat))];
            document.getElementById('cat-nav').innerHTML = cats.map(c=> 
                `<button class="cat-btn" id="b-${c}" onclick="setCat('${c}')"><i class="fas fa-tag"></i>${c}</button>`
            ).join('');
            renderFilterChips();
            setCat("All");
            updateDeliveryEstimate();
        }

        function setCat(c) {
            activeCat = c;
            document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
            document.getElementById(`b-${c}`).classList.add('active');
            filterItems();
        }

        function filterItems() {
            let query = document.getElementById('searchBar').value.toLowerCase();
            let filtered = inventory.filter(i => 
                (activeCat==="All" || i.cat===activeCat) && i.name.toLowerCase().includes(query)
            );
            // price filter
            if (priceFilter === 'low') filtered = filtered.filter(i => i.price < 500);
            if (priceFilter === 'high') filtered = filtered.filter(i => i.price >= 500);
            renderGrid(filtered);
        }

        function renderGrid(items) {
            let grid = document.getElementById('product-grid');
            grid.innerHTML = items.map(p => {
                let img = getProductImageStyle(p);
                let brandMatch = p.name.match(/\(([^)]+)\)/);
                let brand = brandMatch ? brandMatch[1] : '';
                return `<div class="product-card">
                    <div class="product-image" style="${img.background}">
                        <div style="font-size:2.5rem;">${img.emoji}</div>
                        <div style="font-weight:bold;font-size:0.9rem;background:rgba(0,0,0,0.3);padding:3px 8px;border-radius:20px;">${img.shortName}</div>
                        ${brand?`<div style="font-size:0.7rem;">${brand}</div>`:''}
                    </div>
                    <span class="status-chip ${p.limit?'limited':'in-stock'}">${p.limit?'‚ö†Ô∏è limited':'‚úÖ in stock'}</span>
                    <h3>${p.name}</h3>
                    <div class="price-tag">‚Ç®${p.price}</div>
                    <button class="add-to-cart" onclick="updateQty(${p.id},1)"><i class="fas fa-plus-circle"></i> Add</button>
                </div>`;
            }).join('');
        }

        // ---- cart functions ----
        function updateQty(id, change) {
            if (!cart[id]) cart[id] = 0;
            cart[id] += change;
            if (cart[id] <= 0) delete cart[id];
            refreshCart();
        }

        function clearFullCart() { cart = {}; refreshCart(); }

        function refreshCart() {
            let ids = Object.keys(cart);
            let totalQty = ids.reduce((a,id)=>a+cart[id],0);
            document.getElementById('cart-count').innerText = totalQty;
            let cont = document.getElementById('cart-content');
            if (!ids.length) {
                cont.innerHTML = `<div style="padding:20px; text-align:center;"><i class="fas fa-basket-shopping" style="font-size:2.4rem;opacity:0.4;"></i><p>Basket empty</p></div>`;
                document.getElementById('total-val').innerText='0';
                return;
            }
            let sub=0;
            cont.innerHTML = ids.map(id=>{
                let it = inventory.find(p=>p.id==id);
                sub += it.price * cart[id];
                return `<div class="cart-item">
                    <span class="cart-item-name">${it.name.split(' ').slice(0,2).join(' ')}</span>
                    <div class="qty-wrap"><button class="qty-btn" onclick="updateQty(${id},-1)"><i class="fas fa-minus"></i></button><span class="qty-value">${cart[id]}</span><button class="qty-btn" onclick="updateQty(${id},1)"><i class="fas fa-plus"></i></button></div>
                    <span class="item-price">‚Ç®${it.price*cart[id]}</span>
                </div>`;
            }).join('');
            document.getElementById('total-val').innerText = (sub+DELIVERY_FEE).toLocaleString();
        }

        // ---- address save / load ----
        function saveCurrentAddress() {
            let shipHouse = document.getElementById('shipHouse').value.trim();
            let shipStreet = document.getElementById('shipStreet').value.trim();
            let shipSector = document.getElementById('shipSector').value.trim();
            let shipCity = document.getElementById('shipCity').value.trim();
            if (!shipHouse || !shipStreet || !shipSector || !shipCity) {
                alert('Please fill shipping address first');
                return;
            }
            savedAddress = { house: shipHouse, street: shipStreet, sector: shipSector, city: shipCity };
            localStorage.setItem('savedAddress', JSON.stringify(savedAddress));
            displaySavedAddress();
        }

        function displaySavedAddress() {
            let saved = localStorage.getItem('savedAddress');
            if (saved) {
                let addr = JSON.parse(saved);
                document.getElementById('savedAddressDisplay').style.display = 'flex';
                document.getElementById('savedAddressText').innerText = `${addr.house}, ${addr.street}, ${addr.sector}, ${addr.city}`;
            } else {
                document.getElementById('savedAddressDisplay').style.display = 'none';
            }
        }

        function loadSavedAddressToShipping() {
            let saved = localStorage.getItem('savedAddress');
            if (saved) {
                let a = JSON.parse(saved);
                document.getElementById('shipHouse').value = a.house || '';
                document.getElementById('shipStreet').value = a.street || '';
                document.getElementById('shipSector').value = a.sector || 'Korang Town';
                document.getElementById('shipCity').value = a.city || 'Islamabad';
            }
        }

        // ---- address tabs ----
        function showAddressTab(tab) {
            document.querySelectorAll('.addr-tab').forEach(t=>t.classList.remove('active'));
            if (tab==='shipping') {
                document.querySelector('.addr-tab').classList.add('active');
                document.getElementById('shippingSection').style.display = 'block';
                document.getElementById('billingSection').style.display = 'none';
            } else {
                document.querySelectorAll('.addr-tab')[1].classList.add('active');
                document.getElementById('shippingSection').style.display = 'none';
                document.getElementById('billingSection').style.display = 'block';
            }
        }

        function copyShippingToBilling() {
            if (document.getElementById('copyShipping').checked) {
                document.getElementById('billHouse').value = document.getElementById('shipHouse').value;
                document.getElementById('billStreet').value = document.getElementById('shipStreet').value;
                document.getElementById('billSector').value = document.getElementById('shipSector').value;
                document.getElementById('billCity').value = document.getElementById('shipCity').value;
            }
        }

        // ---- delivery estimate ----
        function updateDeliveryEstimate() {
            let now = new Date();
            let hours = now.getHours();
            let mins = now.getMinutes();
            let estimate = 'today (within 2h)';
            if (hours >= 21 || hours < 8) estimate = 'tomorrow morning (by 10am)';
            else if (hours > 14) estimate = 'today (by 6pm)';
            document.getElementById('deliveryDate').innerText = estimate;
        }
        setInterval(updateDeliveryEstimate, 60000); // update every minute

        // ---- send order (WhatsApp) with full details ----
        function sendOrder() {
            let ids = Object.keys(cart);
            if (!ids.length) return alert('Basket empty');
            let shipH = document.getElementById('shipHouse').value.trim();
            let shipS = document.getElementById('shipStreet').value.trim();
            let shipSec = document.getElementById('shipSector').value.trim();
            let shipC = document.getElementById('shipCity').value.trim();
            if (!shipH || !shipS || !shipSec || !shipC) return alert('Fill shipping address');

            let billH = document.getElementById('billHouse').value.trim() || shipH;
            let billS = document.getElementById('billStreet').value.trim() || shipS;
            let billSec = document.getElementById('billSector').value.trim() || shipSec;
            let billC = document.getElementById('billCity').value.trim() || shipC;

            let payment = document.querySelector('input[name="payment"]:checked').value;
            let paymentText = {cash:'Cash on delivery', card:'Card', jazzcash:'JazzCash'}[payment] || 'Cash';

            let msg = `*ISLAMABAD MEGA MART ORDER*%0A%0A`;
            let total = 0;
            ids.forEach(id => {
                let it = inventory.find(p=>p.id==id);
                msg += `‚Ä¢ ${it.name} x ${cart[id]} = ‚Ç®${it.price * cart[id]}%0A`;
                total += it.price * cart[id];
            });
            msg += `%0Aüöö Delivery: ‚Ç®50`;
            msg += `%0Aüí≥ Payment: ${paymentText}`;
            msg += `%0Aüì¶ Est. delivery: ${document.getElementById('deliveryDate').innerText}`;
            msg += `%0A%0Aüìç SHIPPING: ${shipH}, ${shipS}, ${shipSec}, ${shipC}`;
            if (billH+','+billS+','+billSec+','+billC !== shipH+','+shipS+','+shipSec+','+shipC) {
                msg += `%0Aüßæ BILLING: ${billH}, ${billS}, ${billSec}, ${billC}`;
            }
            msg += `%0A%0A*TOTAL: ‚Ç®${total+DELIVERY_FEE}*`;
            window.open(`https://wa.me/${MY_PHONE}?text=${encodeURIComponent(msg)}`,'_blank');
        }

        // toggle cart for mobile
        function toggleCart() {
            document.getElementById('cart-sidebar').classList.toggle('active');
        }

        // load saved address on start
        window.onload = function() {
            init();
            loadSavedAddressToShipping();
            displaySavedAddress();
            // also set billing same as shipping default checkbox
            document.getElementById('copyShipping').checked = true;
            copyShippingToBilling();
        };
    </script>
</body>
</html>
